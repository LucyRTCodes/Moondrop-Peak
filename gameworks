const prompt = require('prompt-sync')(); //this defines the prompt bit

let moneyTotal = 10 // this is the amount of money players start with

/*function Values(keyName, keyCost, keyGrowTime, keyProduces, keyPlanted = false, keyGrowCounter, keyShopQuantity = 0, keyInventoryQuantity = 0) {
    let object = { name: keyName, cost: keyCost, growTime: keyGrowTime, produces: keyProduces, planted: keyPlanted, growCounter: keyGrowCounter, shopQuantity: keyShopQuantity, inventoryQuantity: keyInventoryQuantity }
    return object
}*/
/*function produceValues(keyName, keyCost, keyShopQuantity = 0, keyInventoryQuantity = 0) {
    let object = { name: keyName, cost: keyCost, shopQuantity: keyShopQuantity, inventoryQuantity: keyInventoryQuantity }
    return object
}*/

//produce
/*const carrot = Values("carrots", 3, 0, 0)
const parsnip = Values("parsnips", 4, 0, 0)
const broccoli = Values("broccolis", 5, 0, 0)
const asparagus = Values("asparagus", 3, 0, 0)
const pea = Values("peas", 4, 0, 0)
const lettuce = Values("lettuces", 5, 0, 0)
const strawberry = Values("strawberries", 4, 0, 0)
const raspberry = Values("raspberries", 5, 0, 0)

//seeds
const carrotSeed = Values("carrot seeds", 1, 3, carrot)
const parsnipSeed = Values("parsnip seeds", 2, 3, parsnip)
const broccoliSeed = Values("broccoli seeds", 3, 5, broccoli)
const asparagusSeed = Values("asparagus seeds", 1, 3, asparagus)
const peaSeed = Values("pea seeds", 2, 3, pea)
const lettuceSeed = Values("lettuce seeds", 3, 5, lettuce)
const strawberrySeed = Values("strawberry seeds", 1, 3, strawberry)
const raspberrySeed = Values("raspberry seeds", 2, 3, raspberry)*/

//produce
const carrot = { name: "carrots", cost: 3, shopQuantity: 0, inventoryQuantity: 0 }
const parsnip = { name: "parsnips", cost: 4, shopQuantity: 0, inventoryQuantity: 0 }
const broccoli = { name: "broccolis", cost: 5, shopQuantity: 0, inventoryQuantity: 0 }
const asparagus = { name: "asparagus", cost: 3, shopQuantity: 0, inventoryQuantity: 0 }
const pea = { name: "peas", cost: 4, shopQuantity: 0, inventoryQuantity: 0 }
const lettuce = { name: "lettuces", cost: 5, shopQuantity: 0, inventoryQuantity: 0 }
const strawberry = { name: "strawberries", cost: 4, shopQuantity: 0, inventoryQuantity: 0 }
const raspberry = { name: "raspberries", cost: 5, shopQuantity: 0, inventoryQuantity: 0 }

//seeds
const carrotSeed = { name: "carrot seeds", cost: 1, growTime: 3, produces: carrot, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }
const parsnipSeed = { name: "parsnip seeds", cost: 2, growTime: 3, produces: parsnip, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }
const broccoliSeed = { name: "broccoli seeds", cost: 3, growTime: 5, produces: broccoli, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }
const asparagusSeed = { name: "asparagus seeds", cost: 1, growTime: 3, produces: asparagus, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }
const peaSeed = { name: "pea seeds", cost: 2, growTime: 3, produces: pea, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }
const lettuceSeed = { name: "lettuce seeds", cost: 3, growTime: 5, produces: lettuce, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }
const strawberrySeed = { name: "strawberry seeds", cost: 1, growTime: 3, produces: strawberry, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }
const raspberrySeed = { name: "raspberry seeds", cost: 2, growTime: 3, produces: raspberry, planted: false, growCounter: 0, shopQuantity: 0, inventoryQuantity: 0 }


const objects = [
    carrotSeed,
    parsnipSeed,
    broccoliSeed,
    asparagusSeed,
    peaSeed,
    lettuceSeed,
    strawberrySeed,
    raspberrySeed,
    carrot,
    parsnip,
    broccoli,
    asparagus,
    pea,
    lettuce,
    strawberry,
    raspberry]

let shop = []
let seedsPlanted = []
let produceGrown = []

seedsPlanted = [0,]
produceGrown = [0,]

function checkInventory() {
    inventoryContents = ""
    for (let i = 0; i < objects.length; i++) {
        if (objects[i].inventoryQuantity) {
            inventoryContents += objects[i].inventoryQuantity + " " + objects[i].name + " "
        }
    }
}

function printGarden() {
    seedsPlantedContents = ""
    for (let i = 1; i < seedsPlanted.length; i++) {
        if (seedsPlanted[i].planted) {
            seedsPlantedContents += seedsPlanted[i].name
        }
    }
    produceGrownContents = ""
    for (let i = 1; i < produceGrown.length; i++) {
        produceGrownContents += produceGrown[i].name
    }
    if (seedsPlanted.length > 1 && produceGrown.length > 1) {
        console.log(`You have ${seedsPlantedContents} growing in your garden and ${produceGrownContents} ready to harvest`)
    } else if (seedsPlanted.length > 1) {
        console.log(`You have ${seedsPlantedContents} growing in your garden`)
    } else if (produceGrown.length > 1) {
        console.log(`You have ${produceGrownContents} ready to harvest`)
    } else {
        console.log("Your garden is empty")
    }
}

function grow(seed) {
    let seedName = seed

    const seedNameObjectI = objects.findIndex(objects => {
        return objects.name == seedName
    })

    let seedDayCount = { name: seedName, count: 0 }
    counters.push(seedDayCount)

    let growTime = objects[seedNameObjectI].growTime

    const seedNameI = counters.findIndex(counters => {
        return counters.name == seedName
    })
}

let dayCounter = { name: "day counter", count: 1 }
let counters = [dayCounter]
let winter = false

function seasonCycle() {

    do {
        console.log(`It's day ${dayCounter.count}`)
        if (produceGrown.length > 1) {
            console.log("You have crops ready to harvest!")
        }
        let actionCount = 0
        actionPrompt = "What would you like to do today? "

        do {
            let userAction = prompt(actionPrompt)

            switch (userAction) {

                //THIS IS WHERE SHOP STARTS
                case ("shop"):
                    console.log("You chose shop")

                    let sale = Math.floor(Math.random() * 10) // this checks for a sale
                    if (sale < 4) {
                        console.log("The shop is having a sale!")
                        for (let i = 0; i < shop.length; i++) {
                            shop[i].cost = Math.ceil(shop[i].cost * 0.5)
                            console.log("The sale price of " + shop[i].name + " is " + shop[i].cost)
                        }
                    } else {
                        for (let i = 0; i < shop.length; i++) {
                            console.log("The price of " + shop[i].name + " is " + shop[i].cost)
                        }
                    }
                    for (let i = 0; i < shop.length; i++) { // this tells the player what the store is selling
                        shop[i].shopQuantity = Math.floor(Math.random() * 10)
                    }

                    let exitShop = false

                    do {
                        shopAction = prompt("Would you like to buy or sell? ") // this asks what the user wants to do and stores it as userAction

                        if (shopAction === "buy") { // this starts the loop for buying

                            let buyMore = true // this lets the player decide if they want to buy more than one item

                            do {
                                for (let i = 0; i < shop.length && shop[i].shopQuantity; i++) { // this tells the player what the store is selling
                                    console.log(`This shop sells ${shop[i].shopQuantity} ${shop[i].name}`) // this says what the shop sells and how many of each
                                }
                                let userBuyChoice = prompt("What would you like to buy? ") // this asks what the player wants to buy and stores it as userSeedChoice
                                console.log(`You have chosen ${userBuyChoice}`) // this tells the player what they've chosen

                                const userBuyChoiceIndex = shop.findIndex(shop => {
                                    return shop.name == userBuyChoice
                                })
                                let choice = shop[userBuyChoiceIndex]
                                if (moneyTotal >= choice.cost && choice.shopQuantity > 0) {
                                    console.log(`You have enough money to buy ${userBuyChoice}.`)
                                    let numberBought = Number(prompt("How many would you like to buy? "))
                                    if (numberBought <= choice.shopQuantity) {
                                        console.log(`You bought ${numberBought} ${userBuyChoice}.`)
                                        for (let i = 0; i < numberBought; i++) {
                                            choice.inventoryQuantity++
                                            moneyTotal -= choice.cost
                                            choice.shopQuantity--
                                        }
                                    } else {
                                        console.log(`That's too many ${userBuyChoice}!`)
                                    }
                                } else {
                                    console.log(`You can't buy ${userBuyChoice}!`)
                                }

                                inventoryContents = ""// this tells the player their inventory
                                for (let k = 0; k < objects.length; k++) {
                                    if (objects[k].inventoryQuantity) {
                                        inventoryContents += objects[k].inventoryQuantity + " " + objects[k].name + " "
                                    }
                                }
                                if (inventoryContents) {
                                    console.log(`You have ${inventoryContents}in your inventory`)
                                } else {
                                    console.log("You have nothing in your inventory.")
                                }
                                console.log(`You have £${moneyTotal}.`) // this tells the player how much money they have left
                                buyMore = prompt("Would you like to buy something else? ") // this asks the user if they'd like to buy more
                            } while (buyMore != "no"); // this loops the entire buying section if the player wants to buy more
                            exitShop = prompt("Would you like to exit shop? ")

                        } else if (shopAction === "sell") { // this runs when the player chooses sell
                            checkInventory()
                            if (inventoryContents) {
                                console.log(`You have ${inventoryContents}in your inventory`)
                            } else {
                                console.log("You have nothing to sell.")
                            }

                            let userSellChoice = prompt("What would you like to sell? ") // this saves what the user wants to sell to userSellChoice
                            console.log(`You want to sell ${userSellChoice}`)

                            const userSellChoiceIndex = objects.findIndex(objects => {
                                return objects.name == userSellChoice
                            })
                            let choice = objects[userSellChoiceIndex]
                            if (choice.inventoryQuantity) {
                                let numberSold = prompt("How many do you want to sell? ")
                                if (numberSold <= choice.inventoryQuantity) {
                                    for (let l = 0; l < numberSold; l++) {
                                        choice.inventoryQuantity-- // check this
                                        moneyTotal += choice.cost
                                        choice.shopQuantity++
                                    }
                                    if (inventoryContents) {
                                        console.log(`You have ${inventoryContents}in your inventory`)
                                    } else {
                                        console.log("You have nothing in your inventory.")
                                    }
                                    console.log(`You have £${moneyTotal}.`)
                                }
                            } else {
                                console.log(`There are no ${userSellChoice} in your inventory`)
                            }
                            exitShop = prompt("Would you like to exit shop? ")
                        }
                    } while (exitShop != "yes")
                    break;

                //THIS IS WHERE FARM STARTS
                case ("farm"):
                    if (!winter) {
                        let farmChoice = prompt("Would you like to plant or harvest? ")

                        if (farmChoice == "plant") {
                            checkInventory()
                            if (inventoryContents) {
                                console.log(`You have ${inventoryContents}in your inventory`)
                                let plantSeed = prompt("Which seeds would you like to plant? ")
                                const plantSeedIndex = objects.findIndex(objects => {
                                    return objects.name == plantSeed
                                })
                                let choice = objects[plantSeedIndex]
                                if (choice.inventoryQuantity) {
                                    numberPlanted = prompt("How many would you like to plant? ")
                                    if (numberPlanted <= choice.inventoryQuantity) {
                                        choice.planted = true
                                        seedsPlanted.push(choice)
                                        for (let i = 0; i < numberPlanted; i++) {
                                            choice.inventoryQuantity--
                                            grow(plantSeed)
                                        }
                                        if (numberPlanted == 1) {
                                            console.log(`1 ${plantSeed} has been planted`)
                                        } else {
                                            console.log(`${numberPlanted} ${plantSeed} have been planted`)
                                        }
                                        checkInventory()
                                        if (inventoryContents) {
                                            console.log(`You have ${inventoryContents}in your inventory`)
                                        } else {
                                            console.log("You have nothing in your inventory.")
                                        }
                                    }
                                }
                            } else {
                                console.log("You have nothing in your inventory.")
                            }
                            printGarden()

                        } else if (farmChoice == "harvest") {
                            if (produceGrown.length) {
                                printGarden()
                                let harvestAll = prompt("Harvest all? ")
                                if (harvestAll == "yes") {
                                    for (let i = 1; i < produceGrown.length; i++) {
                                        //const cropIndex = objects.findIndex(objects => {
                                        //    return objects.name == i
                                        //})
                                        produceGrown[i].inventoryQuantity++
                                        produceGrown.splice(i)
                                    }
                                } else {
                                produceGrown.forEach(element => console.log(element.name))
                                harvestWhich = prompt("Which crop would you like to harvest? ")
                                const cropIndex = produceGrown.findIndex(produceGrown => {
                                    return produceGrown.name == harvestWhich
                                })
                                produceGrown[cropIndex].inventoryQuantity++
                                produceGrown.splice(cropIndex)
                            }
                            checkInventory()
                            console.log(`You have ${inventoryContents}in your inventory`)
                            printGarden()
                        } else {
                            console.log("There are no crops ready to harvest")
                        }
                    } else {
                        console.log("You can't do that")
                    }
            } else {
                console.log("You can't farm in winter")
            }
            break;

                case ("end day"):
            actionCount = 5
            break;

                default:
            console.log("You can't do that.")
            actionCount--
            break;
        }
            actionPrompt = "What else would you like to do today? "
            actionCount++
    } while (actionCount <= 4)

    if (seedsPlanted.length) {
        for (let checkSeedPlanted = 1; checkSeedPlanted < seedsPlanted.length; checkSeedPlanted++) {
            if (counters[checkSeedPlanted].count < seedsPlanted[checkSeedPlanted].growTime) {
                console.log(seedsPlanted[checkSeedPlanted].name + " is still growing") // works
            } else if (counters[checkSeedPlanted].count = seedsPlanted[checkSeedPlanted].growTime) {
                console.log("Time to turn seeds into veggies")
                seedsPlanted[checkSeedPlanted].growTime = 0
                counters.splice(checkSeedPlanted)
                produceGrown.push(seedsPlanted[checkSeedPlanted].produces)
                seedsPlanted.splice(checkSeedPlanted)
            } else {
                console.log("Something has gone very wrong")
            }
        }
    }
    console.log("End of day")
    for (i = 0; i < counters.length; i++) {
        counters[i].count++
    }
    console.log(counters)
} while (dayCounter.count <= 28)
}

// THIS CONTROLS THE SEASONS
for (let seasonCount = 1; seasonCount < 5; seasonCount++) {

    switch (seasonCount) {
        case 1:
            winter = false
            console.log("It is spring!")
            shop = [asparagusSeed, peaSeed, lettuceSeed]
            break;

        case 2:
            console.log("It is summer!")
            shop = [lettuceSeed, strawberrySeed, raspberrySeed]
            break;

        case 3:
            console.log("It is autumn!")
            shop = [carrotSeed, parsnipSeed, broccoliSeed]
            break;

        case 4:
            winter = true
            console.log("It is winter!")
            shop = []
            seasonCount -= 4
            break;

        default:
            console.log("Time has broken...")
    }
    dayCounter.count = 1
    seasonCycle()
}